TODO: Fix division by zero handling